<!DOCTYPE html>

<html lang="ja">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta content="hiro" name="author"/>
	<link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <title>{{ playlist_name }}</title>
    <script>
        let tracks = {{ tracks|tojson }};
        let index = 0;
        let audio = new Audio(tracks[index].url);

        function togglePlay() {
            if (audio.paused) {
                play();
            } else {
                pause();
            }
        }

		function play() {
			let artworkUrl = tracks[index].image_url;
			if (!artworkUrl) {
				artworkUrl = "{{ url_for('static', filename='noimage.jpg') }}"; // アートワークがない場合のデフォルト画像
			}
			document.getElementById('playing-artwork').src = artworkUrl; // アートワークの更新
			let playingInfo = "#" + (index + 1) + ": " + "<br>" + tracks[index].name + "<br>" + tracks[index].artist;

			playingInfo += '<br><a href="/youtube?track=' + encodeURIComponent(tracks[index].name) + '&artist=' + encodeURIComponent(tracks[index].artist) + '" style="margin-top: 10px; display: inline-block;">';
			playingInfo += '<i class="fab fa-youtube"></i><span class="play-on-youtube"> YouTube</span></a>';

			document.getElementById('playing').innerHTML = playingInfo;
			audio.play();
			audio.onended = playNext;
		}

        function pause() {
            audio.pause();
        }

        function playNext() {
            index = (index + 1) % tracks.length;
			if (tracks[index].url) {
				audio.src = tracks[index].url;
				play();
			} else {
				playNext(); // URLがNoneの場合、次の曲にスキップ
    		}
        }

        function previous() {
            index = (index - 1 + tracks.length) % tracks.length;
			if (tracks[index].url) {
				audio.src = tracks[index].url;
				play();
			} else {
				previous(); // URLがNoneの場合、前の曲にスキップ
						}
        }

		function playSpecificTrack(trackIndex) {
			index = trackIndex;
			if (tracks[index].url) {
				audio.src = tracks[index].url;
				play();
			} else {
				playNext(); // URLがNoneの場合、次の曲にスキップ
			}
		}

    </script>
</head>
<body>
	<h1>{{ playlist_name }}</h1>
<div id="controls">
    <div id="playing-container">
		<img id="playing-artwork" src="{{ url_for('static', filename='noimage.jpg') }}" alt="再生中のアートワーク">
        <div id="playing"></div>
    </div>
    <div id="buttons">
        <button onclick="previous()">&#10073;&#9664;</button>
        <button onclick="togglePlay()">&#9654;&#10074;&#10074;</button>
        <button onclick="playNext()">&#9654;&#10073;</button>
    </div>
</div>

<div class="custom-list">

    {% for track in tracks %}
    <div class="custom-list-item">
        <span class="custom-list-number">{{ "{:02d}".format(loop.index) }}.</span>
		<span class="custom-list-content">
			<div class="track-info">{{ track.name }} - {{ track.artist }}</div>
			<div class="icon-row">
        		<a href="/youtube?track={{ track.name|urlencode }}&artist={{ track.artist|urlencode }}" style="margin-right: 14px;">
           		<i class="fab fa-youtube"></i><span class="youtube-icon-caption"> YouTube</span></a>
        		{% if track.url %}
        			<a href="javascript:void(0);" onclick="playSpecificTrack({{ loop.index0 }})">
            		<i class="fab fa-spotify"></i><span class="youtube-icon-caption"> Spotify (Preview)</span></a>
        		{% else %}
        			<i class="fab fa-spotify icon-disabled"></i><span class="youtube-icon-caption"> Spotify (No Preview)</span>
        		{% endif %}
    		</div>
		</span>
    </div>
    {% endfor %}

</div>

<footer>
	<p>&copy;2023 Developed by hiro. Data sourced from <a href="https://www.spotify.com" target="_blank"><i class="fab fa-spotify"></i>
Spotify</a> and <a href="https://www.youtube.com/" target="_blank"><i class="fab fa-youtube"></i>
YouTube</a>.</p>
    <p><a href="{{ url_for('static', filename='privacy-policy-en.html') }}" target="_blank">Privacy Policy</a> | <a href="{{ url_for('static', filename='privacy-policy.html') }}" target="_blank">プライバシーポリシー</a></p>
    <p><a href="http://www.tunenest.com/">Explore more music on TuneNest</a></p>
</footer>

</body>
</html>
