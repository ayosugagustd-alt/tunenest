<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="hiro" name="author"/>
    <meta content="Views song details." name="description"/>
    <meta name="robots" content="noindex, follow">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="{{ url_for('static', filename='styles.css') }}" rel="stylesheet"/>
    <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='f_f_event_43_s16_f_event_43_0nbg.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='f_f_event_43_s32_f_event_43_0nbg.png') }}">
    <link rel="icon" type="image/png" sizes="64x64" href="{{ url_for('static', filename='f_f_event_43_s64_f_event_43_0nbg.png') }}">
    <title>{{ song.name }} - Track Details</title>
</head>
<body>
    {% macro render_progress_bar(property, value, bar_class="") %}
        <p><strong>{{ property }}</strong>: {{ value|float|round(1) }}%</p>
        <div class="progress-bar">
            <div class="progress {{ bar_class }}" style="width:{{ value }}%"></div>
        </div>
    {% endmacro %}
    <h1>{{ song.name }}</h1>
    <div class="section-space">
        <a href="{{ amazon_search_url }}" target="_blank" rel="noopener"><i class="fab fa-amazon"></i>Search on Amazon</a>
        <div class="album-artwork">
            <img alt="Album Artwork" src="{{ song.album_artwork_url or url_for('static', filename='noimage.jpg') }}" loading="lazy"/>
        </div>
        <iframe title="Spotify player" allow="encrypted-media" allowtransparency="true" frameborder="0" height="80" src="https://open.spotify.com/embed/track/{{ song_id }}" width="300"></iframe>
        <p class="lyrics">{{ song.lyrics|safe }}</p>
    </div> <!-- End of .section-space -->
    <div class="section-space">
        <h2>Basic Information</h2>
        <!-- code for song properties -->
        <p><strong>Artists</strong>: 
        <ul>
            {% for artist in song.artists %}
                <li><a href="{{ url_for('artist_details', artist_id=artist.id) }}">{{ artist.name }}</a></li>
            {% endfor %}
        </ul>
        <p><strong>Popularity</strong>: {{ song.popularity }}%</p>
        <span class="stars">
            {% for _ in range(0, song.popularity // 10) %}
                <span class="star"><i class="fas fa-star"></i></span>
            {% endfor %}
            {% if song.popularity % 10 >= 5 %}
                <span class="half-star"><i class="fas fa-star-half-alt"></i></span>
            {% endif %}
            {% for _ in range(0, 10 - (song.popularity // 10) - (song.popularity % 10 >= 5)) %}
                <span class="empty-star"><i class="far fa-star"></i></span>
            {% endfor %}
        </span>
        <p><strong>Duration</strong>: {{ (song.duration // 60)|int }}:{{ "%02d"|format(song.duration % 60) }} ({{ song.duration|float|round(1) }} seconds)</p>
        <p><strong>Tempo</strong>: {{ song.tempo|float|round(1) }} BPM</p>
        <p><strong>Time Signature</strong>: {{ song.time_signature }} beats per measure</p>
        <p><strong>Key</strong>: {{ ["C", "C#/Db", "D", "D#/Eb", "E", "F", "F#/Gb", "G", "G#/Ab", "A", "A#/Bb", "B"][song.key] }}</p>
        <p><strong>Mode</strong>: {{ "Major" if song.mode == 1 else "Minor" }}</p>
    </div> <!-- End of div -->
    <div class="visual-section">
        <h2>Music Characteristics <span class="help-link"><a href="/help_song_details" target="_blank" rel="noopener">(What is this?)</a></span></h2>
        <!-- code for visual properties -->
        {{ render_progress_bar("Valence", song.valence, "progress-valence") }}
        {{ render_progress_bar("Acousticness", song.acousticness, "progress-acousticness") }}
        {{ render_progress_bar("Danceability", song.danceability, "progress-danceability") }}
        {{ render_progress_bar("Energy", song.energy, "progress-energy") }}
        {{ render_progress_bar("Instrumentalness", song.instrumentalness, "progress-instrumentalness") }}
    </div> <!-- End of .visual-section -->
    <footer>
        <p>Data sourced from <a href="https://www.spotify.com" target="_blank" rel="noopener"><i class="fab fa-spotify"></i> Spotify</a>.</p>
        <p>Lyrics provided by <a href="https://www.musixmatch.com" target="_blank" rel="noopener">musixmatch</a>.</p>
    </footer>
</body>
</html>
